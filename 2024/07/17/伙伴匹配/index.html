<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1">
    <meta name="keywords" content="Hexo Theme Keep">
    <meta name="description" content="Hexo Theme Keep">
    <meta name="author" content="Keep Team">
    
    <title>
        
            伙伴匹配 |
        
        Keep Theme
    </title>
    
<link rel="stylesheet" href="/css/style.css">

    
        <link rel="shortcut icon" href="/images/logo.svg">
    
    
<link rel="stylesheet" href="/font/css/fontawesome.min.css">

    
<link rel="stylesheet" href="/font/css/regular.min.css">

    
<link rel="stylesheet" href="/font/css/solid.min.css">

    
<link rel="stylesheet" href="/font/css/brands.min.css">

    
    <script class="keep-theme-configurations">
    const KEEP = window.KEEP || {}
    KEEP.hexo_config = {"hostname":"example.com","root":"/","language":"en"}
    KEEP.theme_config = {"base_info":{"primary_color":"#0066cc","title":"Keep Theme","author":"Keep Team","avatar":"/images/avatar.svg","logo":"/images/logo.svg","favicon":"/images/logo.svg"},"menu":{"home":"/","archives":"/archives"},"first_screen":{"enable":false,"background_img":"/images/bg.svg","background_img_dark":"/images/bg.svg","description":"Keep writing and Keep loving.","hitokoto":false},"social_contact":{"enable":false,"links":{"github":null,"weixin":null,"qq":null,"weibo":null,"zhihu":null,"twitter":null,"x":null,"facebook":null,"email":null}},"scroll":{"progress_bar":false,"percent":false,"hide_header":true},"home":{"announcement":null,"category":false,"tag":false,"post_datetime":"updated"},"post":{"author_badge":{"enable":true,"level_badge":true,"custom_badge":["One","Two","Three"]},"word_count":{"wordcount":false,"min2read":false},"datetime_format":"YYYY-MM-DD HH:mm:ss","copyright_info":false,"share":false,"reward":{"enable":false,"img_link":null,"text":null}},"code_block":{"tools":{"enable":false,"style":"default"},"highlight_theme":"default"},"toc":{"enable":false,"number":false,"expand_all":false,"init_open":true,"layout":"right"},"website_count":{"busuanzi_count":{"enable":false,"site_uv":false,"site_pv":false,"page_pv":false}},"local_search":{"enable":false,"preload":false},"comment":{"enable":false,"use":"valine","valine":{"appid":null,"appkey":null,"server_urls":null,"placeholder":null},"gitalk":{"github_id":null,"github_admins":null,"repository":null,"client_id":null,"client_secret":null,"proxy":null},"twikoo":{"env_id":null,"region":null,"version":"1.6.36"},"waline":{"server_url":null,"reaction":false,"version":"3.2.1"},"giscus":{"repo":null,"repo_id":null,"category":"Announcements","category_id":null,"reactions_enabled":false},"artalk":{"server":null},"disqus":{"shortname":null}},"rss":{"enable":false},"lazyload":{"enable":false},"cdn":{"enable":false,"provider":"cdnjs"},"pjax":{"enable":false},"footer":{"since":2020,"word_count":false,"site_deploy":{"enable":false,"provider":"github","url":null},"record":{"enable":false,"list":[{"code":null,"link":null}]}},"inject":{"enable":false,"css":[null],"js":[null]},"root":"","source_data":{},"version":"4.1.5"}
    KEEP.language_ago = {"second":"%s seconds ago","minute":"%s minutes ago","hour":"%s hours ago","day":"%s days ago","week":"%s weeks ago","month":"%s months ago","year":"%s years ago"}
    KEEP.language_code_block = {"copy":"Copy code","copied":"Copied","fold":"Fold code block","folded":"Folded"}
    KEEP.language_copy_copyright = {"copy":"Copy copyright info","copied":"Copied","title":"Original post title","author":"Original post author","link":"Original post link"}
  </script>
<meta name="generator" content="Hexo 7.3.0"></head>


<body>
<div class="progress-bar-container">
    

    
</div>



<main class="page-container border-box">
    <!-- home first screen  -->
    

    <!-- page content -->
    <div class="page-main-content border-box">
        <div class="page-main-content-top">
            
<header class="header-wrapper">

    <div class="border-box header-content">
        <div class="left border-box">
            
                <a class="logo-image border-box" href="/">
                    <img src="/images/logo.svg">
                </a>
            
            <a class="site-name border-box" href="/">
               Keep Theme
            </a>
        </div>

        <div class="right border-box">
            <div class="pc">
                <ul class="menu-list">
                    
                        
                        <li class="menu-item">
                            <a class=""
                               href="/"
                            >
                                
                                HOME
                            </a>
                        </li>
                    
                        
                        <li class="menu-item">
                            <a class=""
                               href="/archives"
                            >
                                
                                ARCHIVES
                            </a>
                        </li>
                    
                    
                </ul>
            </div>
            <div class="mobile">
                
                <div class="icon-item menu-bar">
                    <div class="menu-bar-middle"></div>
                </div>
            </div>
        </div>
    </div>

    <div class="header-drawer">
        <ul class="drawer-menu-list">
            
                
                <li class="drawer-menu-item flex-center">
                    <a class=""
                       href="/"
                    >HOME</a>
                </li>
            
                
                <li class="drawer-menu-item flex-center">
                    <a class=""
                       href="/archives"
                    >ARCHIVES</a>
                </li>
            
        </ul>
    </div>

    <div class="window-mask"></div>

</header>


        </div>

        <div class="page-main-content-middle border-box">

            <div class="main-content border-box">
                

                    
<div class="fade-in-down-animation">
    <div class="post-page-container border-box">
        <div class="post-content-container border-box">
            

            <div class="post-content-bottom border-box">
                
                    <div class="post-title">
                        伙伴匹配
                    </div>
                

                
                    <div class="post-header border-box">
                        
                            <div class="avatar-box border-box">
                                <img src="/images/avatar.svg">
                            </div>
                        
                        <div class="info-box">
                            <div class="author border-box">
                                <span class="name">Keep Team</span>
                                
                                    <span class="author-badge">Lv1</span>
                                
                            </div>
                            <div class="meta-info border-box">
                                

<div class="post-meta-info-container border-box post">
    <div class="post-meta-info border-box">
        

        
            <span class="meta-info-item post-create-date">
                <i class="icon fa-solid fa-calendar-plus"></i>&nbsp;
                <span class="datetime">2024-07-17 04:54:29</span>
            </span>

            <span class="meta-info-item post-update-date">
                <i class="icon fa-solid fa-file-pen"></i>&nbsp;
                <span class="datetime" data-updated="Wed Jul 17 2024 04:55:47 GMT+0800">2024-07-17 04:55:47</span>
            </span>
        

        

        
            <span class="post-tag meta-info-item border-box">
                <ul class="post-tag-ul">
                    
                            <li class="tag-item"><span class="tag-separator"><i class="icon fas fa-hashtag"></i></span><a href="/tags/Java-%E4%B8%9A%E5%8A%A1-%E5%88%86%E5%B8%83%E5%BC%8F%E9%94%81/">Java 业务 分布式锁</a></li>
                        
                    
                </ul>
            </span>
        

        
        
        
        
    </div>

    
</div>

                            </div>
                        </div>
                    </div>
                

                <div class="post-content keep-markdown-body ">
                    

                    
                         <h3 id="修改用户表"><a href="#修改用户表" class="headerlink" title="修改用户表"></a>修改用户表</h3><p>用户有哪些标签？</p>
<p>设计方案</p>
<p>​	1.直接在用户补充tags字段（节省开发成本）</p>
<p>​		优点：查询方便，使用like”%Java%”，不用新建关联表，标签是用户的固有属性（除了该系统，其它系统可能也要用到，是用户的固有属性）</p>
<p>哪怕性能低了，也可以用缓存。</p>
<p>​	2.加一个关联表，记录用户和标签的关系</p>
<p>​		关联表的应用场景：查询灵活，可以正查反查</p>
<p>​		缺点：要多建一个表，多维护一个表。根据标签查用户方便，但是要查询某个列表下的用户很麻烦。</p>
<p>​		<strong>场景：查询用户列表，查关系表拿到这100个用户的所有标签id，再根据标签id去查标签。</strong></p>
<p>注意：这里不一定是因为多对多关系才选方案2，而是多对多关系你也可以在用户表中的tags字段中直接插入[“”,””]json格式的字符串也能实现多对多关系</p>
<p>重点：企业大项目开发尽量减少关联查询。很影响扩展性。而且会影响查询性能</p>
<p>加索引场景：加在可能有很多值的列（即使加了索引也要查很多记录的情况下就不建议加）</p>
<h4 id="根据标签搜索用户"><a href="#根据标签搜索用户" class="headerlink" title="根据标签搜索用户"></a>根据标签搜索用户</h4><p>1.like模糊查询</p>
<p>2.正则表达式</p>
<h5 id="开发后端接口"><a href="#开发后端接口" class="headerlink" title="开发后端接口"></a>开发后端接口</h5><p>搜索标签</p>
<p>​	1.允许用户传入多个标签，多个标签都存在才搜索出来 and</p>
<p>​	2.允许用户传入多个标签，有任何一个标签存在都能搜索出来 or</p>
<p>两种方式：</p>
<p>​	1.SQL查询（实现简单，可以通过拆分查询进一步优化）</p>
<p>​	2.内存查询（灵活，可以通过并发进一步优化查询）</p>
<p>对比时间注意：数据库连接也需要时间</p>
<p>解析JSON字符串</p>
<p>序列化: Java对象转成Json</p>
<p>反序列化:Json转为Java对象</p>
<p>思考有时候内存查询快，数据库查询慢，有时候数据库查询快，内存查询慢，如何解决？</p>
<p>优化：如果参数可以分析的情况下，根据用户的参数去选择查询方式，比如标签数。</p>
<p>如果参数不可分析，并且数据库连接足够，内存空间足够，可以并发同时查询，谁先返回用谁。</p>
<p>还可以SQL查询与内存计算相结合，比如先用SQL过滤掉部分tag</p>
<h3 id="第二期"><a href="#第二期" class="headerlink" title="第二期"></a>第二期</h3><p>在Lambda表达式中把串行流转换成并行流，只需将Stream改成parallelStream即可</p>
<p>把内存查询串行的改成并行，虽然能提高响应事件，但也会有问题？</p>
<p>但是假如查询MySQL非常耗时，那么这个线程池里的线程就会被消耗干净。</p>
<p>感兴趣可以搜索<a class="link"   target="_blank" rel="noopener" href="https://blog.csdn.net/zjcsuct/article/details/107274285" >https://blog.csdn.net/zjcsuct/article/details/107274285<i class="fas fa-external-link-alt"></i></a></p>
<h3 id="第三期"><a href="#第三期" class="headerlink" title="第三期"></a>第三期</h3><p>后端整合Swagger+Knife4j接口文档</p>
<p>什么是接口文档？根据代码生成文档</p>
<p>写接口信息的文档，每条接口包括</p>
<p>1.请求参数</p>
<p>2.响应参数</p>
<p>​	错误码</p>
<p>3.接口地址</p>
<p>4.接口名称</p>
<p>5.请求类型</p>
<p>6.请求格式</p>
<p>7.备注</p>
<p>谁用？一般是后端或者负责人来提供，后端和前端都要使用。</p>
<p>为什么需要接口文档？</p>
<p>​	有个书面内容（背书或者归档），便于大家参考和查阅，便于<strong>沉淀和维护</strong>，拒绝口口相传</p>
<p>​	接口文档便于前端和后端开发对接，前后端联调的<strong>介质</strong>。后端&#x3D;&gt;接口文档&lt;&#x3D;前端</p>
<p>​	好的接口文档支持在线调试，在线测试，可以作为工具提高开发效率。</p>
<p>怎么做接口文档？</p>
<p>​	1.手写（比如腾讯文档，markdown笔记）</p>
<p>​	2.自动化接口文档生成：自动根据项目代码生成完整的文档或在线调试的网页。Swagger，Postman(侧重接口管理)</p>
<p>接口文档有哪些技巧？</p>
<p>Swagger原理：</p>
<p>1.先引入依赖，自定义Swagger配置类</p>
<p>2.定义需要生成接口文档的代码位置(Controller),千万注意：线上环境不要把接口暴露出去。</p>
<p>如何隐藏：可以通过在Swagger配置文件中加@Profile(“”)限制仅在部分环境开启</p>
<p>使用：<a class="link"   target="_blank" rel="noopener" href="https://blog.csdn.net/zhanggonglalala/article/details/98070986" >https://blog.csdn.net/zhanggonglalala/article/details/98070986<i class="fas fa-external-link-alt"></i></a></p>
<p>如果springboot version &gt;&#x3D;2.6需要添加如下配置</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">mvc:</span><br><span class="line">  pathmatch:</span><br><span class="line">    matching-strategy: ant_path_matcher</span><br></pre></td></tr></table></figure>

<p>3.启动即可</p>
<p>4.可以通过在controller方法上添加@Api来自定义信息</p>
<p>缺点：管理能力差以及接口文档与代码绑死</p>
<h4 id="存量用户信息及导入"><a href="#存量用户信息及导入" class="headerlink" title="存量用户信息及导入"></a>存量用户信息及导入</h4><p>1.把所有用户的信息导入</p>
<p>2.把写了自我介绍的同学的标签信息导入</p>
<h4 id="看上了网页信息，怎么抓到？"><a href="#看上了网页信息，怎么抓到？" class="headerlink" title="看上了网页信息，怎么抓到？"></a>看上了网页信息，怎么抓到？</h4><p>1.分析原网站是如何获取数据？哪个接口？</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line">curl &quot;https://api.zsxq.com/v2/hashtags/15522121841242/topics?count=1&quot; ^</span><br><span class="line">  -H &quot;authority: api.zsxq.com&quot; ^</span><br><span class="line">  -H &quot;accept: application/json, text/plain, */*&quot; ^</span><br><span class="line">  -H &quot;accept-language: zh-CN,zh;q=0.9,en;q=0.8,ja;q=0.7&quot; ^</span><br><span class="line">  -H &quot;cache-control: no-cache&quot; ^</span><br><span class="line">  -H &quot;origin: https://wx.zsxq.com&quot; ^</span><br><span class="line">  -H &quot;pragma: no-cache&quot; ^</span><br><span class="line">  -H &quot;referer: https://wx.zsxq.com/&quot; ^</span><br><span class="line">  -H &quot;sec-ch-ua: ^\^&quot;Not_A Brand^\^&quot;;v=^\^&quot;8^\^&quot;, ^\^&quot;Chromium^\^&quot;;v=^\^&quot;120^\^&quot;, ^\^&quot;Google Chrome^\^&quot;;v=^\^&quot;120^\^&quot;&quot; ^</span><br><span class="line">  -H &quot;sec-ch-ua-mobile: ?0&quot; ^</span><br><span class="line">  -H &quot;sec-ch-ua-platform: ^\^&quot;Windows^\^&quot;&quot; ^</span><br><span class="line">  -H &quot;sec-fetch-dest: empty&quot; ^</span><br><span class="line">  -H &quot;sec-fetch-mode: cors&quot; ^</span><br><span class="line">  -H &quot;sec-fetch-site: same-site&quot; ^</span><br><span class="line">  -H &quot;user-agent: Mozilla/5.0 (Windows NT 10.0; Win64; x64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/120.0.0.0 Safari/537.36&quot; ^</span><br><span class="line">  --compressed</span><br></pre></td></tr></table></figure>

<p>2.用程序去调用接口（java&#x2F;python 都可以）</p>
<p>3.处理（清洗）一下数据，之后就可以写到数据库里</p>
<h5 id="流程"><a href="#流程" class="headerlink" title="流程"></a>流程</h5><p>1.从excel中导入全量的用户数据，<strong>判重</strong></p>
<p>2.抓取写了自我介绍的同学信息，提取出用户昵称，用户唯一id，自我介绍信息</p>
<p>3.从自我介绍中提取信息，然后写入到数据库中</p>
<p>java适合做大数据，但是不适合做数据分析。</p>
<h4 id="EasyExcel"><a href="#EasyExcel" class="headerlink" title="EasyExcel"></a>EasyExcel</h4><p>两种读方式：</p>
<p>​	1.读取表头:建立对象,和表头形参映射关系</p>
<p>​	2.不确定表头:每一行数据映射为Map&lt;String,Object&gt;</p>
<p>两种读取方式：</p>
<p>​	1.监听器：先创建监听器，在读取文件时绑定监听器。</p>
<p>​	优点：单独抽离处理逻辑，清晰易于维护，一条一条处理，适用于数据量大的场景。</p>
<p>​	2.同步读：无需创建监听器，一次必须获取完整的数据。</p>
<p>​	优点：方便，简单</p>
<p>​	缺点：数据量大时会有等待时长，可能会有卡顿，也有内存溢出的风险。</p>
<h4 id="Session共享"><a href="#Session共享" class="headerlink" title="Session共享"></a>Session共享</h4><p>种session的时候注意范围，cookie.domain</p>
<p>比如两个域名</p>
<p>aaa.zlz.com</p>
<p>bbb.zlz.com</p>
<p>不同的domain和不同的path数据隔离</p>
<p>浏览器发请求时会先查找domain和path，</p>
<p>如果要共享cookie，可以种一个更高层的公共域名，比如zlz.com</p>
<h4 id="为什么服务器A登录后，请求发送到服务器B，不认识该用户？"><a href="#为什么服务器A登录后，请求发送到服务器B，不认识该用户？" class="headerlink" title="为什么服务器A登录后，请求发送到服务器B，不认识该用户？"></a>为什么服务器A登录后，请求发送到服务器B，不认识该用户？</h4><p>用户在A登录，所以session(用户登录信息)存在A上</p>
<p>结果请求B时，B没有用户信息，所以不认识</p>
<p>解决方案：共享存储，而不是放在单台服务器内存中</p>
<p><img   src="F:\迅雷下载\work\notebook\source_posts\伙伴匹配\Snipaste_2024-05-24_15-17-20.png"  alt="Snipaste_2024-05-24_15-17-20"></p>
<p>如何共享存储？</p>
<p>1.MySQL</p>
<p>2.文件服务器ceph</p>
<p>3Redis(基于内存的K&#x2F;V数据库)，选择Redis，因为用户信息&#x2F;是否登录的判断及其频繁</p>
<p>Redis基于内存，读写性能很高，简单的数据单机qps 5W-10W</p>
<p>JWT主要是做签名认证。</p>
<p>JWT主要应用场景：</p>
<p>1.有效期端</p>
<p>2.只希望被使用一次</p>
<h4 id="更新用户"><a href="#更新用户" class="headerlink" title="更新用户"></a>更新用户</h4><p>说明情况下写到service里？</p>
<p>1.方法有可能被其它服务调用的时候</p>
<p>如果管理员修改用户信息和用户修改自己的用户信息复杂可以分开写。</p>
<p>2.@postMapping请求参数中一定要有@RequestBody </p>
<h4 id="开发主页"><a href="#开发主页" class="headerlink" title="开发主页"></a>开发主页</h4><p>最简单：直接list列表</p>
<p>模拟1000万用户，再去查询</p>
<h4 id="导入数据"><a href="#导入数据" class="headerlink" title="导入数据"></a>导入数据</h4><p>1.用可视化界面：适合一次性导入，数据量可控</p>
<p>2.写程序：for循环，建议分批，不要一把嗦（可以用接口控制）</p>
<p>为什么？如果一次性导入1000万，数据库10分钟都不一定搞得完，影响其它部门使用数据库。此时又要把程序杀掉，此时接口就都挂掉了。</p>
<p>要保证可控，幂等，注意线上环境和测试环境是有区别的。</p>
<p>3.只需SQL语句：适合小数据量</p>
<h4 id="编写一次性任务（定时任务）"><a href="#编写一次性任务（定时任务）" class="headerlink" title="编写一次性任务（定时任务）"></a>编写一次性任务（定时任务）</h4><p>1.现在application上写注解@EnableScheduling</p>
<p>2.再在对应的执行方法中写@Scheduled，告知以什么形式，什么频率执行</p>
<p>@Scheduled(initialDelay &#x3D; 5000, fixedDelay &#x3D; Long.MAX_VALUE)只执行单次任务</p>
<p>for循环插入数据的问题：</p>
<p>​	1.建立和释放数据库连接（批量查询解决）</p>
<p>​	2.for循环是绝对线性的（异步）</p>
<p>注意：1.并发要注意执行的先后顺序无所谓，不要用到非并发类的集合（例如List），需要转换成线程安全的集合。</p>
<p>2.线程不是开的越多越好，例如20份任务（线程数），实际上只有15个人干活，有5个人干了两份活。</p>
<p>​	那么此时该如何提高呢？把能同时干活的人数提高（提高线程池大小）</p>
<p>批量插入代码</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br></pre></td><td class="code"><pre><span class="line">    @Resource</span><br><span class="line">    private UserService userService;</span><br><span class="line"></span><br><span class="line">    /**</span><br><span class="line">     * 批量插入用户</span><br><span class="line">     */</span><br><span class="line">//    @Scheduled(initialDelay = 5000, fixedDelay = Long.MAX_VALUE)</span><br><span class="line">    public void doInsertUsers()&#123;</span><br><span class="line">        StopWatch stopWatch = new StopWatch();</span><br><span class="line">        stopWatch.start();</span><br><span class="line">        final int INSERT_NUM = 10000000;</span><br><span class="line">        List&lt;User&gt; userList = new ArrayList&lt;&gt;();</span><br><span class="line">        for (int i = 0; i &lt; INSERT_NUM; i++) &#123;</span><br><span class="line">            User user = new User();</span><br><span class="line">            user.setUserAccount(&quot;fakezlz&quot;);</span><br><span class="line">            user.setUserPassword(&quot;123456&quot;);</span><br><span class="line">            user.setUserName(&quot;假zlz&quot;);</span><br><span class="line">            user.setUserAvatar(&quot;&quot;);</span><br><span class="line">            user.setUserProfile(&quot;&quot;);</span><br><span class="line">            user.setUserRole(&quot;user&quot;);</span><br><span class="line">            user.setTags(&quot;[]&quot;);</span><br><span class="line">            userList.add(user);</span><br><span class="line">        &#125;</span><br><span class="line">        //与数据库建立连接后批量插入数据,每批插入100条</span><br><span class="line">        userService.saveBatch(userList,100);</span><br><span class="line">        stopWatch.stop();</span><br><span class="line">        System.out.println(stopWatch.getTotalTimeMillis());</span><br></pre></td></tr></table></figure>



<p>要想提升性能得知道性能的瓶颈在哪里，如果要开多线程提高性能，就得看性能瓶颈是java程序的线程数，还是MySQL数据库的连接数。</p>
<p>注意：前端一次性查询的记录不能太多，因为浏览器有限制，否则会崩溃。</p>
<p>mybatisplus分页要先设置配置</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br></pre></td><td class="code"><pre><span class="line">/**</span><br><span class="line"> * MyBatis Plus 配置</span><br><span class="line"> *</span><br><span class="line"> * @author https://github.com/liyupi</span><br><span class="line"> */</span><br><span class="line">@Configuration</span><br><span class="line">@MapperScan(&quot;com.yupi.springbootinit.mapper&quot;)</span><br><span class="line">public class MyBatisPlusConfig &#123;</span><br><span class="line"></span><br><span class="line">    /**</span><br><span class="line">     * 拦截器配置</span><br><span class="line">     *</span><br><span class="line">     * @return</span><br><span class="line">     */</span><br><span class="line">    @Bean</span><br><span class="line">    public MybatisPlusInterceptor mybatisPlusInterceptor() &#123;</span><br><span class="line">        MybatisPlusInterceptor interceptor = new MybatisPlusInterceptor();</span><br><span class="line">        // 分页插件</span><br><span class="line">        interceptor.addInnerInterceptor(new PaginationInnerInterceptor(DbType.MYSQL));</span><br><span class="line">        return interceptor;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>



<p>数据库慢？预先把数据查出来，放到一个更快读取的地方，不用再查数据库了（缓存）。</p>
<p>为防止用户第一次使用的时候很慢，可以使用定时任务预加载缓存，定时更新缓存。</p>
<p>多台机器都要执行任务么？（分布式锁，控制同一时间只有一台机器去执行定时任务，其它机器不用重复执行）</p>
<h4 id="推荐"><a href="#推荐" class="headerlink" title="推荐"></a>推荐</h4><p>1.每次进入现场运算推荐</p>
<p>2.提前算好推荐</p>
<h3 id="缓存"><a href="#缓存" class="headerlink" title="缓存"></a>缓存</h3><p>单机缓存：</p>
<p>ehcache(单机)</p>
<p>本地缓存(Java内存Map)</p>
<p>Caffeine(Java内存缓存，高性能)</p>
<p>Google Guava</p>
<p> 问题：数据不一致</p>
<hr>
<p>分布式缓存</p>
<p>1.Redis</p>
<p>2.memcached</p>
<p>3.Etcd(云原生架构的分布式存储，<strong>存储配置</strong>，扩容能力优秀，可以线性增加读写性能)</p>
<h4 id="Redis"><a href="#Redis" class="headerlink" title="Redis"></a>Redis</h4><p>NoSQL数据库</p>
<p>key-value存储系统</p>
<h4 id="Java里的实现方式"><a href="#Java里的实现方式" class="headerlink" title="Java里的实现方式"></a>Java里的实现方式</h4><h5 id="1-Spring-Data-Redis-推荐"><a href="#1-Spring-Data-Redis-推荐" class="headerlink" title="1.Spring Data Redis(推荐)"></a>1.Spring Data Redis(推荐)</h5><p>Spring Data：通用的数据访问框架，定义了一组增删改查的接口</p>
<p>mysql、redis、jpa</p>
<p>内置了Lettuce，因此可以在application.yml中进行配置，主要配置连接池等</p>
<p>连接池（线程池）最大的优点：复用</p>
<p>减少开销</p>
<h4 id="2-Jedis"><a href="#2-Jedis" class="headerlink" title="2.Jedis"></a>2.Jedis</h4><p>独立于Spring操作Redis的Java客户端 </p>
<p>要配合Jedis Pool使用</p>
<h4 id="3-Lettuce"><a href="#3-Lettuce" class="headerlink" title="3.Lettuce"></a>3.Lettuce</h4><p><strong>高阶</strong>的操作Redis的Java客户端</p>
<p>异步，连接池</p>
<h4 id="4-Redission"><a href="#4-Redission" class="headerlink" title="4.Redission"></a>4.Redission</h4><p>分布式操作Redis的Java客户端，让你像操作本地的集合一样操作Redission（分布式Redis数据网格）</p>
<h4 id="5-jetCache"><a href="#5-jetCache" class="headerlink" title="5.jetCache"></a>5.jetCache</h4><p>冷门</p>
<p>对比：</p>
<p>​	1.如果用的是Spring,并且没有过多定制化要求，可以使用Spring Data Redis,更方便。</p>
<p>​	2.如果你用的不受Spring,并且追求简单，并且没有过高的性能要求，可以使用Jedis+Jedis Pool</p>
<p>​	3.如果你的项目不受Spring,并且追求高性能，高定制化，可以用Lettuce,支持异步、连接池</p>
<p>​	4.如果你的项目是分布式的，需要用到一些分布式特性（比如分布式锁，分布式集合），推荐使用redission</p>
<h3 id="Redis数据结构"><a href="#Redis数据结构" class="headerlink" title="Redis数据结构"></a>Redis数据结构</h3><p>**String 字符串类型 ： name:”zlz”**（用的最多）</p>
<p>List列表: names:[“zlz”,”dogzlz”,”zlz”]</p>
<p>Set集合: names:[“zlz”,”dogzlz”] (值不能重复)</p>
<p>Hash哈希: nameAge:{“zlz”:1,”dogzlz”:2}</p>
<p>Zset集合: names:{zlz-9,dogzlz-12} (很适合做排行榜)</p>
<hr>
<p>bloomfilter：布隆过滤器，主要从大量的数据中快速过滤值，比如邮件黑名单拦截）</p>
<p>geo(计算地理位置)</p>
<p>hyperloglog(pv&#x2F;uv)</p>
<p>pub&#x2F;sub(发布订阅)</p>
<p>BitMap(1001001000)适合用来存储大量可以压缩的值（应用场景：某人购买了XX，没购买XX）</p>
<p>直接使用redis默认的redistemplate，使用的是java自带的序列化器，而如果使用Stringredis则使用不同的String序列化器。</p>
<h4 id="自定义序列化"><a href="#自定义序列化" class="headerlink" title="自定义序列化"></a>自定义序列化</h4><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br></pre></td><td class="code"><pre><span class="line">package com.yupi.springbootinit.config;</span><br><span class="line"></span><br><span class="line">import org.springframework.context.annotation.Bean;</span><br><span class="line">import org.springframework.context.annotation.Configuration;</span><br><span class="line">import org.springframework.data.redis.connection.RedisConnectionFactory;</span><br><span class="line">import org.springframework.data.redis.core.RedisTemplate;</span><br><span class="line">import org.springframework.data.redis.serializer.RedisSerializer;</span><br><span class="line"></span><br><span class="line">@Configuration</span><br><span class="line">public class RedisTemplateConfig &#123;</span><br><span class="line"></span><br><span class="line">    @Bean</span><br><span class="line">    public RedisTemplate&lt;String, Object&gt; redisTemplate(RedisConnectionFactory redisConnectionFactory) &#123;</span><br><span class="line">        RedisTemplate&lt;String, Object&gt; redisTemplate = new RedisTemplate&lt;&gt;();</span><br><span class="line">        //指定连接工厂</span><br><span class="line">        redisTemplate.setConnectionFactory(redisConnectionFactory);</span><br><span class="line">        //指定序列化器，防止插入Redis的value为空，key为乱码</span><br><span class="line">        redisTemplate.setKeySerializer(RedisSerializer.string());</span><br><span class="line">        return redisTemplate;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>





<p>注意：引入一个库时，先写测试类</p>
<h4 id="设计缓存key"><a href="#设计缓存key" class="headerlink" title="设计缓存key"></a>设计缓存key</h4><p>不同用户看到的数据不同</p>
<p>企业为了节约成本，整个项目可能只使用一个Redis </p>
<p>命名：systemId:moduleId:func:options(不要和别人冲突)</p>
<p>zpao:user:recommend:userId</p>
<p>!!!redis内存不能无限增加，记得设置过期时间，当Redis满的时候会自动淘汰掉部分数据，如果是重要的数据….，而且可以自己设置淘汰策略。</p>
<p>怎么保证触发写缓存的用户访问也很快呢？</p>
<h4 id="缓存预热"><a href="#缓存预热" class="headerlink" title="缓存预热"></a>缓存预热</h4><p>为什么要用缓存预热？</p>
<p>双11时，每个用户都是第一次查缓存，当用户量多时，数据库就会崩溃。</p>
<p>因此缓存也能再一定程度上保护数据库，而且可以让用户始终访问很快。</p>
<p>缺点：</p>
<p>​	1.增加开发成本（需要额外的开发、设计）</p>
<p>​	2.预热的时机和时间如果错了，有可能你缓存的数据不对或者太老</p>
<p>​	3.需要占用额外空间，只缓存用户访问频率高的部分</p>
<blockquote>
<p>分析优缺点时，要打开思路，从整个项目从0到1的链路上去分析</p>
</blockquote>
<h4 id="怎么缓存预热？"><a href="#怎么缓存预热？" class="headerlink" title="怎么缓存预热？"></a>怎么缓存预热？</h4><p>1.定时触发</p>
<p>2.手动触发</p>
<h3 id="定时任务的实现"><a href="#定时任务的实现" class="headerlink" title="定时任务的实现"></a>定时任务的实现</h3><p><strong>1.Spring Scheduler(spring boot 默认整合了)</strong></p>
<p>2.Quartz(独立于Spring存在的定时任务框架)</p>
<p>3.xxl-job分布式任务调度平台（界面+sdk）<strong>可以好好学习一下</strong></p>
<h4 id="实现"><a href="#实现" class="headerlink" title="实现"></a>实现</h4><p>用定时任务，每天刷新所有用户的推荐列表</p>
<p>注意点：</p>
<p>​	1.缓存预热的意义（新增少，总用户多）</p>
<p>​	2.缓存的空间不能太大，要预留给其它缓存空间</p>
<p>​	3.缓存数据的周期（此处每天一次）</p>
<p>怎么解决定时任务初始化npe导致定时任务不执行的问题？</p>
<p>直接try-cache</p>
<p>第一种方式：</p>
<p>​	1.主类开启@EnableScheduling</p>
<p>​	2.给要定时执行的方法添加@Scheduling 注解，使用corn表达式或者执行频率</p>
<p>注意：定时任务不能执行太长，今天跑到明天去了，那就会出问题，如果执行时间过长，想办法用并发优化。</p>
<p>todo：给数据库加一个标识，区分哪些是重点用户，这样就不用在代码中写死了。</p>
<p>做程序员多考虑：这样设计是否合理， 我要用哪个技术，这个技术要不要做选择，这个技术的特性要不要用。</p>
<h4 id="控制定时任务的执行"><a href="#控制定时任务的执行" class="headerlink" title="控制定时任务的执行"></a>控制定时任务的执行</h4><p>要控制定时任务在同一时间只有1个服务器执行</p>
<p>为啥？</p>
<ol>
<li>浪费资源，想象10000台服务器同时“打鸣”</li>
<li>脏数据，比如重复</li>
</ol>
<p>怎么做？几种方案</p>
<ol>
<li><p>分离定时任务程序和主程序，只在1个服务器运行定时任务，成本太大</p>
</li>
<li><p>写死配置，每个服务器都指向定时任务，但是只有ip符合配置的服务器才真实指向业务逻辑，其它直接返回。成本最低；但是我们的IP可能是不固定的，把IP写的太死了。</p>
</li>
<li><p>动态配置，配置是可以轻松的，很方便地更新的（代码无需重启），但是只有ip符合配置的服务器才真实执行业务逻辑。</p>
</li>
</ol>
<p>​		数据库</p>
<p>​		Redis</p>
<p>​		配置中心(Nacos、Apollo、Spring Cloud Config)</p>
<p>问题：服务器多路，IP不可控还是很麻烦，还是要人工修改</p>
<ol start="4">
<li>分布式锁，只有抢到锁的服务器才能执行业务逻辑。坏处: 增加成本; 好处: 不用手动配置，多少个服务器都一样。</li>
</ol>
<h3 id="分布式锁"><a href="#分布式锁" class="headerlink" title="分布式锁"></a>分布式锁</h3><p>1.有限资源的情况下，控制同一时间（段）只有某些线程(用户&#x2F;服务器)能访问资源</p>
<p>2.单个锁只对单个JVM有效</p>
<h4 id="枪锁机制"><a href="#枪锁机制" class="headerlink" title="枪锁机制"></a>枪锁机制</h4><p>怎么保证同一时间只有一个服务器能够抢到锁?</p>
<p>核心思想：先来的人先把数据改成自己的标识（服务器ip），后来的人发现标识已存在，就代表抢锁失败，放弃或继续等待</p>
<p>等先来的人执行方法结束，把标识清空，其它的人继续抢锁。</p>
<h4 id="实现方式"><a href="#实现方式" class="headerlink" title="实现方式"></a>实现方式</h4><p>MySQL数据库: select for update 行级锁(最简单)，或者用乐观锁</p>
<p>Redis实现:内存数据库，读写速度快。支持setnx,lua脚本，比较方便我们实现分布式锁</p>
<p>setnx：set if not exist 如果不存在，则设置；只有设置成功才会返回true,否则返回false</p>
<h4 id="注意事项"><a href="#注意事项" class="headerlink" title="注意事项"></a>注意事项</h4><ol>
<li>用完锁要释放(腾地方)</li>
<li>锁一定要加过期时间</li>
<li>如果方法执行时间过长，锁提前过期了?</li>
</ol>
<p>导致问题：</p>
<p>1） 连锁效应:释放掉别人的锁</p>
<p>2）这样还是会存在多个方法同时执行的情况</p>
<p>解决方案:续期</p>
<ol start="4">
<li>释放锁的时候，有可能先判断出是自己的锁，但这时锁过期了，最后还是释放了别人的锁<ol>
<li>解决方案：Redis+lua脚本保持操作原子性</li>
</ol>
</li>
</ol>
<p>高阶知识：</p>
<p>Redis集群时,出现了Redis数据不一致的情况如何解决？</p>
<ol start="4">
<li>Redis如果是集群（而不是只有一个Redis）,如果分布式锁的数据不同步怎么办?</li>
</ol>
<p>​			解决方案：<a class="link"   target="_blank" rel="noopener" href="https://blog.csdn.net/feiying0canglang/article/details/113258494" >https://blog.csdn.net/feiying0canglang/article/details/113258494<i class="fas fa-external-link-alt"></i></a></p>
<p>​			简而言之：操作Redis，如果有一半的Redis操作成功，才能算是执行成功</p>
<h4 id="Redission实现分布式锁"><a href="#Redission实现分布式锁" class="headerlink" title="Redission实现分布式锁"></a>Redission实现分布式锁</h4><p>定义：是一个java操作Redis的客户端，<strong>提供了大量的分布式数据集来简化对Redis的操作和使用，可以让开发者像使用本地集合一样使用Redis，完全感知不到Redis的存在。</strong></p>
<p>2种引入方式</p>
<p>1.spring boot starter 引入（不推荐，版本迭代快，容易冲突）</p>
<p>2.直接引入<a class="link"   target="_blank" rel="noopener" href="https://github.com/redisson/redisson#quick-start" >https://github.com/redisson/redisson#quick-start<i class="fas fa-external-link-alt"></i></a></p>
<p>为什么他能像操作本地集合那样进行操作，是因为他继承了同样的接口</p>
<h4 id="定时任务-锁"><a href="#定时任务-锁" class="headerlink" title="定时任务+锁"></a>定时任务+锁</h4><ol>
<li>waitTime设置为0，只抢一次，抢不到就算了。</li>
<li>注意释放锁要写在finally中</li>
</ol>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">//只能释放自己的锁</span><br><span class="line">if(lock.isHeldByCurrentThread())&#123;</span><br><span class="line">    lock.unlock();</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>这样释放锁有问题：如果在执行到这个代码之前就报错了。</p>
<h4 id="看门狗机制"><a href="#看门狗机制" class="headerlink" title="看门狗机制"></a>看门狗机制</h4><blockquote>
<p>redisson中提供的续期机制</p>
</blockquote>
<p>给加锁的方法添加监听器，如果你的锁要过期了，但方法没执行完，就会自动重置锁的过期时间。</p>
<p>原理：</p>
<ol>
<li>监听当前线程，每10s续期一次，默认过期时间是30s。</li>
<li>如果线程挂掉（注意debug模式也会被它当成服务器宕机），则不会续期。</li>
</ol>
<p>面试会问：为什么看门狗要设置一个默认过期时间为30s的过期时间?</p>
<p>怕宕机。无论如何Redis一定要加过期时间</p>
<h3 id="组队功能"><a href="#组队功能" class="headerlink" title="组队功能"></a>组队功能</h3><p>理想的应用场景：要跟别人一起参加竞赛或者做项目，可以发起队伍或者加入到别人对外。</p>
<h4 id="需求分析"><a href="#需求分析" class="headerlink" title="需求分析"></a>需求分析</h4><p>用户可以<strong>创建</strong>一个队伍，设置队伍人数，队伍名称（标题）、描述、超时时间。p0</p>
<blockquote>
<p>队长、剩余的人数</p>
<p>聊天？</p>
<p>公开或private或加密</p>
<p>用户创建队伍最多5个 </p>
</blockquote>
<p>根据标签或名称搜索队伍 p0，信息流中不展示已过期的队伍</p>
<p>修改队伍信息 p0-p1</p>
<p>用户可以加入队伍（其它人，未满，未过期），允许加入多个队伍，但是要有个上限 p0</p>
<blockquote>
<p>是否需要队长同意？筛选审批？</p>
</blockquote>
<p>用户可以推出队伍（如果队长退出，权限转移给第二早加入的用户–先来后到）p1</p>
<p>队长可以解散队伍 p0</p>
<p>分享队伍&#x3D;》邀请其它用户加入队伍 p1</p>
<p>队伍人满后发送消息通知 p1</p>
<h4 id="系统设计"><a href="#系统设计" class="headerlink" title="系统设计"></a>系统设计</h4><p>用户可以<strong>创建</strong>一个队伍，设置队伍人数，队伍名称（标题）、描述、超时时间。p0</p>
<blockquote>
<p>队长、剩余的人数</p>
<p>聊天？</p>
<p>公开或private或加密</p>
<p>信息流中不展示已过期的队伍</p>
</blockquote>
<p>1.请求参数是否为空？</p>
<p>2.是否登录，未登录不允许创建</p>
<p>3.校验信息</p>
<p>​	1.队伍人数&gt;1且&lt;&#x3D;20</p>
<p>​	2.队伍标题&lt;&#x3D;20</p>
<p>​	3.描述&lt;&#x3D;512</p>
<p>​	4.status 是否公开(int) 不传默认为0（公开）</p>
<p>​	5.如果status是加密状态，一定要有密码，且密码&lt;&#x3D;32</p>
<p>​	6.超时时间&gt;当前时间</p>
<p>​	7.校验用户最多创建5个队伍</p>
<p>4.插入队伍信息到队伍表</p>
<p>5.插入用户&#x3D;&gt;队伍关系到关系表</p>
<blockquote>
<p>一开始就要想好功能要不要收费，达到多少之后就必须收费，不要一开始设计的系统就全部免费</p>
</blockquote>
<h4 id="1-实现"><a href="#1-实现" class="headerlink" title="1.实现"></a>1.实现</h4><p>库表设计</p>
<p>1.队伍表</p>
<p>字段</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line">CREATE TABLE teams (</span><br><span class="line">    id bigint      AUTO_INCREMENT comment &#x27;id&#x27; primary key ,</span><br><span class="line">    teamName varchar(256) NOT NULL comment &#x27;队伍名称&#x27;,</span><br><span class="line">    description TEXT null comment  &#x27;描述&#x27;,</span><br><span class="line">    maxMembers int default 1 not null comment &#x27;最大人数&#x27;,</span><br><span class="line">    expireTime DATETIME default null comment &#x27;过期时间&#x27;,</span><br><span class="line">    userId bigint comment &#x27;用户id&#x27;,</span><br><span class="line">    status int default 0 not null comment &#x27;0-公开，1-私有，2-加密&#x27;,</span><br><span class="line">    password varchar(512) null comment &#x27;密码&#x27;,</span><br><span class="line">    createTime datetime default CURRENT_TIMESTAMP  null comment &#x27;创建时间&#x27;,</span><br><span class="line">    updateTime datetime default CURRENT_TIMESTAMP  null on update CURRENT_TIMESTAMP comment &#x27;更新时间&#x27;,</span><br><span class="line">    isDelete   tinyint  default 0                 not null comment &#x27;是否删除&#x27;</span><br><span class="line">) comment &#x27;队伍&#x27;;</span><br><span class="line"></span><br></pre></td></tr></table></figure>

<p>两个关系：</p>
<p>1.用户加了哪些队伍？</p>
<p>2.队伍有哪些用户？</p>
<p>方法：</p>
<p>​	<strong>1.建立用户-队伍关系表teamId userId（便于修改，查询性能高，可以选择这个，不用全表遍历，但是删除麻烦）</strong></p>
<p>​	2.用户补充已加入的队伍字段，队伍表补充已加入的用户字段（便于查询，不用写多对多的代码，可以直接根据队伍查用户，根据用户查队伍）</p>
<p>2.用户队伍表</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">CREATE TABLE user_teams (</span><br><span class="line">   id bigint      AUTO_INCREMENT comment &#x27;id&#x27; primary key ,</span><br><span class="line">   userId bigint not null comment &#x27;用户id&#x27;,</span><br><span class="line">   teamId bigint not null comment &#x27;队伍id&#x27;,</span><br><span class="line">   joinTime datetime   null comment &#x27;加入时间-审批队伍时可以使用&#x27;,</span><br><span class="line">   createTime datetime default CURRENT_TIMESTAMP  null comment &#x27;创建时间&#x27;,</span><br><span class="line">   updateTime datetime default CURRENT_TIMESTAMP  null on update CURRENT_TIMESTAMP comment &#x27;更新时间&#x27;,</span><br><span class="line">   isDelete   tinyint  default 0                 not null comment &#x27;是否删除&#x27;</span><br><span class="line">) comment &#x27;用户队伍关系&#x27;;</span><br></pre></td></tr></table></figure>



<h4 id="为什么需要请求参数包装类？"><a href="#为什么需要请求参数包装类？" class="headerlink" title="为什么需要请求参数包装类？"></a>为什么需要请求参数包装类？</h4><p>​	1.请求参数名称&#x2F;类型和实体类不一样</p>
<p>​	2.有一些参数用不到，如果要自动生成接口文档，会增加理解成本</p>
<p>​	3.多个实体类映射到同一个对象</p>
<h4 id="为什么需要包装类？"><a href="#为什么需要包装类？" class="headerlink" title="为什么需要包装类？"></a>为什么需要包装类？</h4><p>可能有些字段需要隐藏，不能返回给前端。</p>
<p>比如某些字段某些方法是不关心的。</p>
<p>增删改查</p>
<p>业务逻辑开发</p>
<h4 id="真实开发中是用校验框架多还是自己手写校验多？"><a href="#真实开发中是用校验框架多还是自己手写校验多？" class="headerlink" title="真实开发中是用校验框架多还是自己手写校验多？"></a>真实开发中是用校验框架多还是自己手写校验多？</h4><p>看业务校验的复杂程度，不变动就手写即可，如果经常变动的话写在配置里或者使用规则引擎。</p>
<h4 id="事务注解"><a href="#事务注解" class="headerlink" title="事务注解"></a>事务注解</h4><p>@Transactional</p>
<p>要么数据操作都成功，要么都失败</p>
<h4 id="2-查询队伍列表"><a href="#2-查询队伍列表" class="headerlink" title="2.查询队伍列表"></a>2.查询队伍列表</h4><p>分页展示队伍列表，根据名称、最大人数等搜索队伍 p0，信息流中不展示已过期的队伍</p>
<p>1.从请求参数中取出队伍名称，如果存在则作为查询条件</p>
<p>2.不展示已过期的队伍（根据过期时间筛选）</p>
<p>3.可以通过某个<strong>关键词</strong>同时对名称和描述查询</p>
<p>4.<strong>只有管理员才能查看加密还有非公开的房间</strong></p>
<p>5.关联查询已加入队伍的用户信息</p>
<p>6.<strong>todo：关联查询已加入队伍的用户信息（可能会很耗费性能，建议用自己写SQL的方式实现）</strong></p>
<h4 id="实现方式-1"><a href="#实现方式-1" class="headerlink" title="实现方式"></a>实现方式</h4><p>1.自己写SQL</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">//1.自己写SQL</span><br><span class="line">        //查询队伍和创建人的信息</span><br><span class="line">        //select * from team t left join user u on t.userId = u.id;</span><br><span class="line">        //查询队伍和已加入队伍成员的信息</span><br><span class="line">        //select * from team t join user_team ut on t.id = user_team.teamId</span><br><span class="line"></span><br></pre></td></tr></table></figure>

<blockquote>
<p>关联多个表还是自己写SQL</p>
</blockquote>
<p>2.写程序的方式</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line">//关联查询创建人的用户信息</span><br><span class="line">       for (Team team : teamList) &#123;</span><br><span class="line">           Long userId = team.getUserId();</span><br><span class="line">           if (userId == null)&#123;</span><br><span class="line">               continue;</span><br><span class="line">           &#125;</span><br><span class="line">           User user = userService.getById(userId);</span><br><span class="line">           TeamUserVO teamUserVO = new TeamUserVO();</span><br><span class="line">           //脱敏用户信息</span><br><span class="line">           if (user != null)&#123;</span><br><span class="line">               UserVO userVO = new UserVO();</span><br><span class="line">               BeanUtils.copyProperties(team,teamUserVO);</span><br><span class="line">               teamUserVO.setCreateUser(userVO);</span><br><span class="line">           &#125;</span><br><span class="line">           teamUserVOList.add(teamUserVO);</span><br><span class="line">       &#125;</span><br></pre></td></tr></table></figure>



<h4 id="3-修改队伍信息"><a href="#3-修改队伍信息" class="headerlink" title="3.修改队伍信息"></a>3.修改队伍信息</h4><ol>
<li>判断请求参数是否为空</li>
<li>查询队伍是否存在</li>
<li>只有管理员或者队伍的创建者可以修改</li>
<li>如果用户传入的新值和老值一致，就不用update了（可自行实现，降低数据库使用次数）</li>
<li>如果队伍状态改为加密，必须要有密码。</li>
<li>更新成功</li>
</ol>
<h4 id="4-用户可以加入队伍"><a href="#4-用户可以加入队伍" class="headerlink" title="4.用户可以加入队伍"></a>4.用户可以加入队伍</h4><p>（其它人，未满，未过期），允许加入多个队伍，但是要有个上限 p0</p>
<ol>
<li>用户最多加入5个队伍</li>
<li>队伍必须存在，只能加入未满、为过期的队伍</li>
<li>不能加入自己的队伍，不能重复加入已加入的队伍（幂等性：无论执行多少次结果都是一样的）</li>
<li>如果加入的队伍是加密的，必须密码匹配才可以</li>
<li>禁止加入私有的队伍</li>
<li>新增队伍，用户关联信息</li>
</ol>
<blockquote>
<p>注意，并发请求时可能出现问题</p>
</blockquote>
<h4 id="5-用户可以退出队伍"><a href="#5-用户可以退出队伍" class="headerlink" title="5.用户可以退出队伍"></a>5.用户可以退出队伍</h4><blockquote>
<p> 如果队长退出，权限转移给第二早加入的用户–先来后到</p>
</blockquote>
<p>请求参数: 队伍id</p>
<ol>
<li><p>校验请求参数</p>
</li>
<li><p>校验队伍是否存在</p>
</li>
<li><p>校验我是否已加入队伍</p>
</li>
<li><p>如果队伍</p>
<ol>
<li><p>只剩一人，队伍解散</p>
<pre><code>1. 还有其他人
</code></pre>
<ol>
<li><p>如果是队长退出队伍，权限转移给第二早加入的用户–先来后到（取id最小的数据）</p>
<blockquote>
<p>只用取id最小的两条数据</p>
</blockquote>
</li>
</ol>
</li>
</ol>
</li>
</ol>
<p>​				  2. 非队长，自己退出队伍</p>
<h4 id="6-队长可以解散队伍"><a href="#6-队长可以解散队伍" class="headerlink" title="6.队长可以解散队伍"></a>6.队长可以解散队伍</h4><p>请求参数：队伍id</p>
<p>业务流程：</p>
<ol>
<li><p>校验请求参数</p>
</li>
<li><p>校验队伍是否存在</p>
</li>
<li><p>校验你是不是队伍的队长</p>
</li>
<li><p>移除所有加入队伍的关联信息</p>
</li>
<li><p>删除队伍</p>
</li>
</ol>
<blockquote>
<p>如果服务中有多个增删检的操作，最好加上事务注解Transactional</p>
</blockquote>
<h4 id="7-获取当前用户已加入的队伍"><a href="#7-获取当前用户已加入的队伍" class="headerlink" title="7.获取当前用户已加入的队伍"></a>7.获取当前用户已加入的队伍</h4><h4 id="8-获取当前用户创建的队伍"><a href="#8-获取当前用户创建的队伍" class="headerlink" title="8.获取当前用户创建的队伍"></a>8.获取当前用户创建的队伍</h4><p>复用listTeam方法，只新增查询条件，不做修改（开闭原则）</p>
<blockquote>
<p>开闭原则，只增加代码，不修改代码</p>
</blockquote>
<h4 id="9-随机匹配"><a href="#9-随机匹配" class="headerlink" title="9.随机匹配"></a>9.随机匹配</h4><blockquote>
<p>为了帮助大家更快的发现和自己兴趣相同的朋友</p>
</blockquote>
<p>匹配1个还是多个?</p>
<p>匹配多个，并且按照匹配的相似度从高到低排序</p>
<h5 id="1-怎么匹配？"><a href="#1-怎么匹配？" class="headerlink" title="1.怎么匹配？"></a>1.怎么匹配？</h5><p>标签tags</p>
<blockquote>
<p>还可以根据user_team匹配加入相同队伍的用户</p>
</blockquote>
<p>本质：找到有相似标签的用户</p>
<p>举例:</p>
<p>用户A: [Java,大一，男]</p>
<p>用户B: [Java,大二，男]</p>
<p>用户C: [Python,大二，女]</p>
<p>方案：</p>
<ol>
<li>找到有共同标签最多的用户（TopN）</li>
<li>共同标签越多，分数越高，越排在前面</li>
<li>如果没有匹配的用户，随便推荐几个（降级方案）</li>
</ol>
<blockquote>
<p>优先级？</p>
</blockquote>
<p>算法：</p>
<ol>
<li><p>knn（最邻近节点算法）</p>
</li>
<li><p>编辑距离算法 ：让一个标签经过n次变化编程另一个标签，根据变化次数进行打分</p>
<blockquote>
<p>最小编辑距离:字符串1通过多少次增删改字符的操作可以编程字符串2</p>
</blockquote>
</li>
<li><p>如果两个用户的标签差不多，该优先推荐哪个？给每个标签打上权重，比如学什么方向重要，性别相对次要</p>
<p>解决方案：余弦相似度匹配算法</p>
</li>
</ol>
<h5 id="2-怎么对所有用户进行匹配，取TOP"><a href="#2-怎么对所有用户进行匹配，取TOP" class="headerlink" title="2.怎么对所有用户进行匹配，取TOP"></a>2.怎么对所有用户进行匹配，取TOP</h5><p>运用到项目的方案</p>
<p>1.直接取出所有的用户，依次与当前用户计算分数，取TopN(54秒)</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br></pre></td><td class="code"><pre><span class="line">@Override</span><br><span class="line">public List&lt;User&gt; machUsers(long nums, User loginUser) &#123;</span><br><span class="line">    List&lt;User&gt; userList = this.list();</span><br><span class="line">    String tags = loginUser.getTags();</span><br><span class="line">    Gson gson = new Gson();</span><br><span class="line">    List&lt;String&gt; tagList = gson.fromJson(tags, new TypeToken&lt;List&lt;String&gt;&gt;() &#123;</span><br><span class="line">    &#125;.getType());</span><br><span class="line">    //用户列表下标=&gt;相似度,数据结构使用错误</span><br><span class="line">    SortedMap&lt;Integer,Long&gt; indexDistanceMap = new TreeMap&lt;&gt;();</span><br><span class="line">    for (int i = 0; i &lt; userList.size(); i++) &#123;</span><br><span class="line">        User user = userList.get(i);</span><br><span class="line">        String userTags = user.getTags();</span><br><span class="line">        //如果无标签</span><br><span class="line">        if (StringUtils.isBlank(userTags))&#123;</span><br><span class="line">            continue;</span><br><span class="line">        &#125;</span><br><span class="line">        //数据格式转换</span><br><span class="line">        List&lt;String&gt; userTagList = gson.fromJson(user.getTags(), new TypeToken&lt;List&lt;String&gt;&gt;() &#123;</span><br><span class="line">        &#125;.getType());</span><br><span class="line">        //计算分数</span><br><span class="line">        long distance = AlgorithmUtils.minDistance(tagList, userTagList);</span><br><span class="line">        //方便后续根据i取相似度</span><br><span class="line">        indexDistanceMap.put(i, distance);</span><br><span class="line">    &#125;</span><br><span class="line">    List&lt;User&gt; userVOList = new ArrayList&lt;&gt;();</span><br><span class="line">    int i = 0;</span><br><span class="line">    for (Map.Entry&lt;Integer, Long&gt; entry : indexDistanceMap.entrySet()) &#123;</span><br><span class="line">        if (i&gt;nums)&#123;</span><br><span class="line">            break;</span><br><span class="line">        &#125;</span><br><span class="line">        User user = userList.get(entry.getKey());</span><br><span class="line">        System.out.println(user.getId()+&quot;:&quot;+entry.getKey()+&quot;:&quot;+entry.getValue());</span><br><span class="line">    &#125;</span><br><span class="line">    return userVOList;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>存在问题：输出结果不对以及如何提升性能</p>
<p>优化方法：</p>
<ol>
<li><p>切忌不要在数据量大的时候循环输出日志（取消掉日志后输出20s）</p>
</li>
<li><p>Map存了所有的分数信息，占用内存</p>
<p>解决：维护一个固定长度的有序集合(sortedSet)，只保留分数最高的几个用户</p>
</li>
</ol>
<p>​		e.g.【3，4，5，6，7】取TOP 5，id为1的用户就不用放进去了（时间换空间）</p>
<ol start="3">
<li>细节: 剔除自己。</li>
<li>尽量只查需要的用户<ol>
<li>过滤掉标签为空的用户</li>
<li>根据部分标签取用户（前提是能区分出来哪个标签比较重要,而且现在的数据库中标签列表是占一个字段，只能使用模糊查询的方式查或者使用Json的方式，这样性能也不是特别高）</li>
<li>只查需要的数据（比如id和tags）（只用了7s）</li>
</ol>
</li>
</ol>
<p>阿里推荐商品，难道要去所有商品里查吗？难道要实时查询吗？			</p>
<p>思考点：真的要实时计算吗，可以提前算好吗？少查数据？</p>
<p>5.提前查？（定时任务）</p>
<ol>
<li><p>提前把所有用户给缓存（不适用于经常更新的数据）</p>
</li>
<li><p>提前运算按出来结果给缓存(针对一些重点用户，提前缓存）</p>
<blockquote>
<p>注意：Redis最好不要存储超过1k的数据，如果数据量大了查Redis要等很久，而且Redis是单线程模型，每次只能执行1条命令。执行一条命令太慢，导致其它命令阻塞。</p>
</blockquote>
</li>
</ol>
<p>6.查出一部分数据，再于当前用户进行相似度比较（这样会增加查询时间，减少运算的时间）</p>
<h5 id="分表学习建议"><a href="#分表学习建议" class="headerlink" title="分表学习建议"></a>分表学习建议</h5><p>7.分表：shardingsphere和mycat(查询分表的框架)、一致性hash</p>
<p>分表策略：根据id，根据主键，根据某个字段把同一个表的数据拆分到多个表。</p>
<p>分表原理：学校有很多学生，将这么多学生分成不同班级，每个班级维护一张表。</p>
<p>分表后要依据<strong>规则</strong>写入和查询表</p>
<h5 id="大数据推荐概述"><a href="#大数据推荐概述" class="headerlink" title="大数据推荐概述"></a>大数据推荐概述</h5><p>大数据推荐，比如说有几亿个商品，难道要查出来所有的商品？</p>
<p>难道要对所有的数据计算一遍相似度？</p>
<p>大数据推荐过程：检索&#x3D;&gt;召回&#x3D;&gt;粗排&#x3D;&gt;精排&#x3D;&gt;重排序等等</p>
<p>检索：尽可能多地查符合要求的数据（比如按数据库搜索记录查询）</p>
<blockquote>
<p>先搜索出符合用户搜索习惯，使用习惯的记录的商品</p>
</blockquote>
<p>召回：查询可能要用到的数据（不做运算）</p>
<blockquote>
<p>但凡和查出的结果有关的数据，你看过和你朋友看过的商品</p>
</blockquote>
<p>粗排：粗略的排序，简单地运算（运算相对轻量）</p>
<blockquote>
<p>经过前面两个步骤得到的数据量还是很大，如果进行精排，会很耗费资源，大致的有可能成为最佳的数据给排出来</p>
</blockquote>
<p>精排：精细排序，确定固定排位</p>
<h4 id="业务思考"><a href="#业务思考" class="headerlink" title="业务思考"></a>业务思考</h4><p>场景：前端要查询当前用户加入哪些队伍</p>
<p>方案一：前端查询我加入了哪些队伍列表，然后判断每个队伍id是否在列表中（前端要多发一次请求）</p>
<p>方案二：在后端去做上述事情。（推荐）</p>
<h4 id="优化"><a href="#优化" class="headerlink" title="优化"></a>优化</h4><p>1.用户加入队伍使用锁</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br></pre></td><td class="code"><pre><span class="line">synchronized (this)&#123;</span><br><span class="line">            //下面逻辑会出现并发问题</span><br><span class="line">            //该用户已加入的队伍数量</span><br><span class="line">            Long userId = loginUser.getId();</span><br><span class="line">            QueryWrapper&lt;UserTeam&gt; userTeamQueryWrapper = new QueryWrapper&lt;&gt;();</span><br><span class="line">            userTeamQueryWrapper.eq(&quot;userId&quot;,userId);</span><br><span class="line">            long hasJoinNum = userTeamService.count(userTeamQueryWrapper);</span><br><span class="line">            if (hasJoinNum &gt; 5)&#123;</span><br><span class="line">                throw new BusinessException(ErrorCode.PARAMS_ERROR,&quot;最多创建或加入5个队伍&quot;);</span><br><span class="line">            &#125;</span><br><span class="line">            //不能重复加入已加入的队伍</span><br><span class="line">            userTeamQueryWrapper = new QueryWrapper&lt;&gt;();</span><br><span class="line">            userTeamQueryWrapper.eq(&quot;userId&quot;,userId);</span><br><span class="line">            userTeamQueryWrapper.eq(&quot;teamId&quot;,teamId);</span><br><span class="line">            long hasUserJoinTeam = userTeamService.count(userTeamQueryWrapper);</span><br><span class="line">            if (hasUserJoinTeam &gt; 0)&#123;</span><br><span class="line">                throw new BusinessException(ErrorCode.PARAMS_ERROR,&quot;用户已加入改队伍&quot;);</span><br><span class="line">            &#125;</span><br><span class="line">            //已加入队伍的人数</span><br><span class="line">            long teamHasJoinNum = this.countTeamUserByTeamId(teamId);</span><br><span class="line">            if (teamHasJoinNum &gt;= team.getMaxMembers())&#123;</span><br><span class="line">                throw new BusinessException(ErrorCode.PARAMS_ERROR,&quot;队伍已满&quot;);</span><br><span class="line">            &#125;</span><br><span class="line">            //新增队伍-用户关联信息</span><br><span class="line">            UserTeam userTeam = new UserTeam();</span><br><span class="line">            userTeam.setUserId(userId);</span><br><span class="line">            userTeam.setTeamId(teamId);</span><br><span class="line">            userTeam.setJoinTime(new Date());</span><br><span class="line">            return userTeamService.save(userTeam); </span><br><span class="line">        &#125;</span><br></pre></td></tr></table></figure>

<p>上述加锁产生的问题：</p>
<p>如果两个线程抢占的不是相同的资源，那么就会造成性能浪费（加入不同队伍的用户可以同时进行）</p>
<p>解决方法：减小锁的粒度，按照队伍和用户id加锁。</p>
<p>注意：</p>
<p>1.锁是加在对象上的，要保证加锁的对象是一致(intern())</p>
<p>2.synchronized：如果有10个服务器都是单线程，一个用户同时往10个服务器发送加入队伍的请求也会导致同时往数据库中插入10条数据（加分布式锁）</p>
<p>2.用户加入队伍时，使用分布式锁</p>
<p>3.如何减小锁的粒度</p>

                    
                </div>

                

                <div class="post-bottom-tags-and-share border-box">
                    <div>
                        
                            <ul class="post-tags-box border-box">
                                
                                    <li class="tag-item border-box">
                                        <i class="icon fas fa-hashtag"></i>&nbsp;<a href="/tags/Java-%E4%B8%9A%E5%8A%A1-%E5%88%86%E5%B8%83%E5%BC%8F%E9%94%81/">Java 业务 分布式锁</a>
                                    </li>
                                
                            </ul>
                        
                    </div>
                    <div>
                        
                    </div>
                </div>

                

                
                    <div class="post-nav border-box">
                        
                        
                            <div class="next-post">
                                <a class="next"
                                   rel="next"
                                   href="/2024/07/17/%E7%BC%96%E7%A8%8B%E5%9C%A8%E7%BA%BF%E8%AF%84%E6%B5%8B%E5%B9%B3%E5%8F%B0/"
                                   title="编程在线评测平台"
                                >
                                    <span class="title flex-center">
                                        <span class="post-nav-title-item text-ellipsis">编程在线评测平台</span>
                                        <span class="post-nav-item">Next posts</span>
                                    </span>
                                    <span class="right arrow-icon flex-center">
                                        <i class="fas fa-chevron-right"></i>
                                    </span>
                                </a>
                            </div>
                        
                    </div>
                

                
                    






                
            </div>
        </div>

        
    </div>
</div>


                
            </div>
        </div>

        <div class="page-main-content-bottom border-box">
            
<footer class="footer border-box">
    <div class="copyright-info info-item">
        &copy;&nbsp;<span>2020</span>&nbsp;-&nbsp;2024
        
            &nbsp;<i class="fas fa-heart icon-animate"></i>&nbsp;&nbsp;<a href="/">Keep Team</a>
        
    </div>

    <div class="theme-info info-item">
        Powered by&nbsp;<a target="_blank" href="https://hexo.io">Hexo</a>&nbsp;&&nbsp;Theme&nbsp;<a class="keep-version" target="_blank" href="https://github.com/XPoet/hexo-theme-keep">Keep</a>
    </div>

    

    

    
</footer>

        </div>
    </div>

    <!-- post tools -->
    
        <div class="post-tools right-toc">
            <div class="post-tools-container border-box">
    <ul class="post-tools-list border-box">
        <!-- PC encrypt again -->
        

        <!-- PC TOC show toggle -->
        

        <!-- PC go comment -->
        

        <!-- PC full screen -->
        <li class="tools-item flex-center full-screen">
            <i class="fa-solid fa-expand"></i>
        </li>
    </ul>
</div>

        </div>
    

    <!-- side tools -->
    <div class="side-tools">
        <div class="side-tools-container border-box ">
    <ul class="side-tools-list side-tools-show-handle border-box">
        <li class="tools-item tool-font-adjust-plus flex-center">
            <i class="fas fa-search-plus"></i>
        </li>

        <li class="tools-item tool-font-adjust-minus flex-center">
            <i class="fas fa-search-minus"></i>
        </li>

        <li class="tools-item tool-toggle-theme-mode flex-center">
            <i class="fas fa-moon"></i>
        </li>

        <!-- rss -->
        

        <li class="tools-item tool-scroll-to-bottom flex-center">
            <i class="fas fa-arrow-down"></i>
        </li>
    </ul>

    <ul class="exposed-tools-list border-box">
        

        

        <li class="tools-item tool-toggle-show flex-center">
            <i class="fas fa-cog fa-spin"></i>
        </li>

        <li class="tools-item tool-scroll-to-top flex-center show-arrow">
            <i class="arrow fas fa-arrow-up"></i>
            <span class="percent"></span>
        </li>
    </ul>
</div>

    </div>

    <!-- image mask -->
    <div class="zoom-in-image-mask">
    <img class="zoom-in-image">
</div>


    <!-- local search -->
    

    <!-- tablet toc -->
    
</main>



<!-- common -->

<script src="/js/utils.js"></script>

<script src="/js/header-shrink.js"></script>

<script src="/js/back2top.js"></script>

<script src="/js/toggle-theme.js"></script>

<script src="/js/code-block.js"></script>

<script src="/js/main.js"></script>

<script src="/js/libs/anime.min.js"></script>


<!-- local-search -->


<!-- lazyload -->


<div class="">
    <!-- home page -->
    

    <!-- post page -->
    
        <!-- post-helper -->
        
<script src="/js/post/post-helper.js"></script>


        <!-- toc -->
        

        <!-- copyright-info -->
        

        <!-- share -->
        
    

    <!-- categories page -->
    

    <!-- links page -->
    

    <!-- photos page -->
    

    <!-- tools page -->
    
</div>

<!-- mermaid -->


<!-- pjax -->



</body>
</html>
